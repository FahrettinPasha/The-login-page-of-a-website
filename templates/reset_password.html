<!DOCTYPE html>
<html>
<head>
    <title>Yeni Şifre Belirle</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <div class="container">
        <h1>Yeni Şifre Belirle</h1>
        {# Flash mesajları burada gösterilir #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        <form action="/sifre_sifirla/{{ token }}" method="POST">
            <input type="password" id="new_password" name="new_password" placeholder="Yeni Şifreniz (min 8 karakter, B/k harf, rakam, özel)" required minlength="8">
            <div id="password-strength-feedback" class="password-feedback"></div> {# Şifre gücü geri bildirimi metni #}
            <div class="password-strength-bar-container">
                <div id="password-strength-bar" class="password-strength-bar"></div> {# Şifre gücü barı #}
            </div>
            <input type="password" name="confirm_password" placeholder="Yeni Şifrenizi Onaylayın" required>
            <button type="submit">Şifreyi Sıfırla</button>
        </form>
    </div>

    <script>
        // Şifre gücü kontrolü için JavaScript (register.html ile aynı mantık)
        const passwordInput = document.getElementById('new_password');
        const passwordFeedback = document.getElementById('password-strength-feedback');
        const passwordStrengthBar = document.getElementById('password-strength-bar');

        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0; // 0-5 arası puan
            let feedbackText = '';
            let feedbackClass = '';
            let barWidth = 0;

            // Şifre gücü kriterleri
            const hasMinLength = password.length >= 8;
            const hasUpperCase = /[A-Z]/.test(password);
            const hasLowerCase = /[a-z]/.test(password);
            const hasDigit = /[0-9]/.test(password);
            const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);

            if (hasMinLength) strength++;
            if (hasUpperCase) strength++;
            if (hasLowerCase) strength++;
            if (hasDigit) strength++;
            if (hasSpecialChar) strength++;

            if (password.length === 0) {
                feedbackText = '';
                feedbackClass = '';
                barWidth = 0;
            } else if (strength < 3) {
                feedbackText = 'Şifre çok zayıf! (En az 8 karakter, B/k harf, rakam, özel karakter içermeli)';
                feedbackClass = 'weak';
                barWidth = (strength / 5) * 100;
            } else if (strength < 5) {
                feedbackText = 'Şifre orta güçlükte.';
                feedbackClass = 'medium';
                barWidth = (strength / 5) * 100;
            } else {
                feedbackText = 'Şifre güçlü!';
                feedbackClass = 'strong';
                barWidth = 100;
            }

            passwordFeedback.textContent = feedbackText;
            passwordFeedback.className = 'password-feedback ' + feedbackClass;

            // Barın genişliğini ve rengini ayarla
            passwordStrengthBar.style.width = barWidth + '%';
            passwordStrengthBar.className = 'password-strength-bar ' + feedbackClass;
        });

        // Sayfa yüklendiğinde şifre gücü geri bildirimini başlat
        document.addEventListener('DOMContentLoaded', function() {
            passwordInput.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>
